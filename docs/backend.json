{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Represents a user account within the AuthConnect application. Note: Passwords and authentication data are handled by Firebase and are not stored in this entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "registrationDate": {
          "type": "string",
          "description": "The date and time when the user registered.",
          "format": "date-time"
        },
        "lastLogin": {
          "type": "string",
          "description": "The date and time of the user's last login.",
          "format": "date-time"
        },
        "profileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserAccount 1:1 UserProfile)"
        }
      },
      "required": [
        "id",
        "email",
        "registrationDate"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents the profile information associated with a user account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "displayName": {
          "type": "string",
          "description": "The display name of the user."
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "avatarUrl": {
          "type": "string",
          "description": "URL of the user's avatar image.",
          "format": "uri"
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserProfile 1:1 UserAccount)"
        }
      },
      "required": [
        "id",
        "displayName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information. Uses path-based ownership for security.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user account, matching the Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/profiles/{profileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Uses path-based ownership for security.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user account, matching the Firebase Authentication UID."
            },
            {
              "name": "profileId",
              "description": "The unique identifier of the user profile."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support user authentication and profile management for the AuthConnect application. It prioritizes security and scalability by adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling. \n\nAuthorization Independence is achieved by storing user data directly under the `/users/{userId}` collection. This eliminates the need for complex `get()` calls in security rules, allowing for atomic operations and easier debugging. This is enforced through path-based ownership, ensuring that each user can only access their own data.\n\nStructural Segregation is maintained by separating user accounts and user profiles into dedicated collections (`/users` and `/users/{userId}/profiles`). This ensures a homogeneous security posture, where all documents within a collection share the same security requirements.\n\nThe structure supports the required QAPs by using path-based ownership for private user data. List operations are secure because rules only allow access to a user's own profile based on their `uid`."
  }
}